<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GALAXIA Launcher v4.5</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0b0f1a">

<!-- PWA -->
<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;GALAXIA Launcher&quot;,
  &quot;short_name&quot;:&quot;GALAXIA&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#05070d&quot;,
  &quot;theme_color&quot;:&quot;#0b0f1a&quot;
}">

<style>
/* ---------- CORE THEME ---------- */
:root {
  --bg:#05070d;
  --panel:rgba(255,255,255,.08);
  --accent:#6b8cff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,sans-serif;
  background:radial-gradient(circle at top,#101a3a,var(--bg));
  color:#fff;
  overflow:hidden;
}
header{
  display:flex;
  align-items:center;
  gap:10px;
  padding:14px;
  font-size:20px;
  font-weight:600;
}
header button,input{
  background:var(--panel);
  border:none;
  color:white;
  padding:8px 12px;
  border-radius:10px;
}
button{cursor:pointer}
#library{
  height:calc(100vh - 70px);
  overflow-y:auto;
  padding:16px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:16px;
}
.card{
  background:var(--panel);
  border-radius:14px;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  transition:.2s;
}
.card:hover{
  transform:scale(1.04);
  box-shadow:0 0 22px rgba(120,150,255,.35);
}
.card img{
  width:100%;
  height:110px;
  object-fit:cover;
  border-radius:8px;
  background:#000;
}
.card small{opacity:.7}
#player{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  z-index:999;
}
#player iframe{
  width:100%;
  height:100%;
  border:none;
}
#exit{
  position:absolute;
  top:10px;
  right:10px;
  z-index:1000;
}
</style>
</head>

<body>

<header>
  GALAXIA v4.5
  <input id="search" placeholder="Search games">
  <button onclick="importGame()">Install Game</button>
  <button onclick="exportLibrary()">Export</button>
  <button onclick="downloadGalaxia()">Download GALAXIA</button>
  <button id="installBtn" hidden onclick="installApp()">Install App</button>
</header>

<div id="library"></div>

<div id="player">
  <button id="exit" onclick="exitGame()">Exit</button>
  <iframe id="frame"></iframe>
</div>

<script>
/* ---------- INSTALLABLE ---------- */
let deferredPrompt;
window.addEventListener("beforeinstallprompt", e=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.hidden=false;
});
function installApp(){deferredPrompt.prompt();}

/* ---------- STORAGE ---------- */
let installed=JSON.parse(localStorage.getItem("galaxia_games")||"[]");

/* ---------- CURATED GAMES (NO DUPES, NO FAKES) ---------- */
const curated=[
  "POLY FPS","Dead Shot Arena","Cube Warfare","Low Poly FPS",
  "WebGL FPS Trainer","Neon Combat","Voxel Shooter",
  "Three.js FPS Demo","Babylon FPS Demo","Arena Shooter JS",
  "Sci-Fi FPS Prototype","Parkour FPS","Dungeon FPS",
  "Zombie Defense WebGL","Mech Arena","Open Arena Prototype",
  "Bot Combat Arena","Physics Sandbox FPS","Cyber Corridor",
  "Procedural FPS","Movement Shooter","Space Marines WebGL",
  "Unity Kart Racer","Survival Island","Space Dogfight",
  "FPS Target Practice","WebXR FPS Demo","Raycast FPS",
  "Multiplayer FPS Prototype","AI Combat Trainer"
].map(n=>({name:n,type:"Available"}));

/* ---------- RENDER ---------- */
const lib=document.getElementById("library");
const search=document.getElementById("search");

function render(){
  lib.innerHTML="";
  const q=search.value.toLowerCase();
  [...installed.map(g=>({...g,installed:true})),
   ...curated.map(g=>({...g,installed:false}))]
  .filter(g=>g.name.toLowerCase().includes(q))
  .forEach(g=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <img src="${g.thumb||''}">
      <b>${g.name}</b>
      <small>${g.type}</small>
      <button ${g.installed?"":"disabled"}>
        ${g.installed?"Play":"Import to Install"}
      </button>`;
    if(g.installed)d.onclick=()=>launchGame(g);
    lib.appendChild(d);
  });
}
search.oninput=render;

/* ---------- IMPORT GAME ---------- */
async function importGame(){
  const dir=await showDirectoryPicker();
  let unity=false;
  for await(const e of dir.values())
    if(e.name.endsWith(".loader.js")) unity=true;
  installed.push({
    name:dir.name,
    type:unity?"Unity WebGL":"HTML",
    handle:dir
  });
  localStorage.setItem("galaxia_games",JSON.stringify(installed));
  render();
}

/* ---------- LAUNCH ---------- */
async function launchGame(g){
  const f=await g.handle.getFileHandle("index.html");
  const url=URL.createObjectURL(await f.getFile());
  frame.src=url;
  player.style.display="block";
  setTimeout(()=>frame.requestFullscreen(),300);
}
function exitGame(){
  document.exitFullscreen?.();
  player.style.display="none";
  frame.src="";
}

/* ---------- EXPORT / DOWNLOAD ---------- */
function exportLibrary(){
  const b=new Blob([JSON.stringify(installed,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="galaxia-library.json";
  a.click();
}
function downloadGalaxia(){
  const b=new Blob([document.documentElement.outerHTML],{type:"text/html"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="galaxia-launcher.html";
  a.click();
}

/* ---------- CONTROLLER ---------- */
setInterval(()=>{
  const g=navigator.getGamepads?.()[0];
  if(!g)return;
  if(g.buttons[0].pressed) document.querySelector(".card")?.click();
  if(g.buttons[1].pressed) exitGame();
},200);

render();
</script>
</body>
</html>
