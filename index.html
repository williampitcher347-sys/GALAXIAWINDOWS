<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Web OS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;font-family:Segoe UI,system-ui}
body{
  margin:0;height:100vh;overflow:hidden;
  background:radial-gradient(circle at top,#1b1f3b,#000);
  color:white;
}
.hidden{display:none}

/* LOGIN */
#login{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
}
#loginBox{
  background:rgba(0,0,0,.7);
  padding:30px;border-radius:12px;
  text-align:center;width:280px;
}
#loginBox input{
  width:100%;padding:8px;margin-top:10px;
}

/* DESKTOP */
#desktop{
  position:absolute;inset:0;
  background:url('https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3') center/cover;
}

/* TASKBAR */
#taskbar{
  position:absolute;bottom:0;width:100%;height:48px;
  background:rgba(20,20,20,.95);
  display:flex;align-items:center;padding:0 8px;
}
.taskBtn{
  width:36px;height:36px;
  background:#222;border-radius:6px;
  margin-right:6px;display:flex;
  align-items:center;justify-content:center;
  cursor:pointer;
}
#clock{margin-left:auto}

/* WINDOWS */
.window{
  position:absolute;
  width:600px;height:400px;
  background:#111;border-radius:8px;
  box-shadow:0 0 20px #000;
  overflow:hidden;
}
.titlebar{
  height:32px;
  background:#0078d7;
  display:flex;align-items:center;
  justify-content:space-between;
  padding:0 8px;cursor:move;
}
.titlebar button{
  background:red;border:none;color:white;
  width:22px;height:22px;cursor:pointer;
}
.content{
  height:calc(100% - 32px);
  background:black;
}

/* FILE LIST */
.file{
  padding:6px;border-bottom:1px solid #333;
  cursor:pointer;
}
.file:hover{background:#333}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <div id="loginBox">
    <h2>Web OS</h2>
    <input id="username" placeholder="Username">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- DESKTOP -->
<div id="desktop" class="hidden"></div>

<!-- TASKBAR -->
<div id="taskbar" class="hidden">
  <div class="taskBtn" onclick="openExplorer()">üìÅ</div>
  <div class="taskBtn" onclick="openBrowser()">üåê</div>
  <div id="clock"></div>
</div>

<input type="file" id="fileInput" multiple hidden>

<script>
/* ===== LOGIN ===== */
let user=null
function login(){
  const u=username.value.trim()
  if(!u)return
  user=u
  localStorage.setItem("webos_user",u)
  loginDiv(false)
}
function loginDiv(show){
  login.classList.toggle("hidden",!show)
  desktop.classList.toggle("hidden",show)
  taskbar.classList.toggle("hidden",show)
}
const saved=localStorage.getItem("webos_user")
if(saved){user=saved;loginDiv(false)}else loginDiv(true)

/* ===== CLOCK ===== */
setInterval(()=>clock.textContent=new Date().toLocaleTimeString(),1000)

/* ===== WINDOW SYSTEM ===== */
let z=1
function createWindow(title){
  const w=document.createElement("div")
  w.className="window"
  w.style.left="120px"
  w.style.top="80px"
  w.style.zIndex=++z

  const t=document.createElement("div")
  t.className="titlebar"
  t.innerHTML=`<span>${title}</span>`
  const cbtn=document.createElement("button")
  cbtn.textContent="X"
  cbtn.onclick=()=>w.remove()
  t.appendChild(cbtn)
  w.appendChild(t)

  const c=document.createElement("div")
  c.className="content"
  w.appendChild(c)

  drag(w,t)
  desktop.appendChild(w)
  return c
}
function drag(w,t){
  let x,y
  t.onmousedown=e=>{
    w.style.zIndex=++z
    x=e.clientX;y=e.clientY
    document.onmousemove=ev=>{
      w.style.left=w.offsetLeft-(x-ev.clientX)+"px"
      w.style.top=w.offsetTop-(y-ev.clientY)+"px"
      x=ev.clientX;y=ev.clientY
    }
    document.onmouseup=()=>document.onmousemove=null
  }
}

/* ===== INDEXED DB ===== */
let db,files=[]
indexedDB.open("WebOS_"+user,1).onupgradeneeded=e=>{
  db=e.target.result
  db.createObjectStore("files",{keyPath:"name"})
}
indexedDB.open("WebOS_"+user,1).onsuccess=e=>{
  db=e.target.result
  loadFiles()
}
function saveFile(f){
  db.transaction("files","readwrite")
    .objectStore("files").put(f)
}
function loadFiles(){
  db.transaction("files","readonly")
    .objectStore("files").getAll().onsuccess=e=>{
      files=e.target.result
    }
}

/* ===== FILE EXPLORER ===== */
function openExplorer(){
  const c=createWindow("File Explorer")
  const up=document.createElement("button")
  up.textContent="Install Files"
  up.onclick=()=>fileInput.click()
  c.appendChild(up)

  const list=document.createElement("div")
  c.appendChild(list)

  function refresh(){
    list.innerHTML=""
    files.forEach(f=>{
      const d=document.createElement("div")
      d.className="file"
      d.textContent=f.name
      d.onclick=()=>openFile(f)
      list.appendChild(d)
    })
  }
  refresh()

  fileInput.onchange=()=>{
    [...fileInput.files].forEach(file=>{
      const r=new FileReader()
      r.onload=()=>{
        saveFile({name:file.name,type:file.type,data:r.result})
        files.push({name:file.name,type:file.type,data:r.result})
        refresh()
      }
      r.readAsDataURL(file)
    })
  }
}

/* ===== OPEN FILE ===== */
function openFile(f){
  const c=createWindow(f.name)
  if(f.type.includes("html")){
    const i=document.createElement("iframe")
    i.srcdoc=atob(f.data.split(",")[1])
    i.style.width="100%"
    i.style.height="100%"
    i.style.border="none"
    c.appendChild(i)
  }
  else if(f.type.startsWith("image")){
    const img=document.createElement("img")
    img.src=f.data;img.style.width="100%"
    c.appendChild(img)
  }
  else if(f.type.startsWith("video")){
    const v=document.createElement("video")
    v.src=f.data;v.controls=true
    v.style.width="100%"
    c.appendChild(v)
  }
  else if(f.type.startsWith("audio")){
    const a=document.createElement("audio")
    a.src=f.data;a.controls=true
    c.appendChild(a)
  }
  else c.textContent="Unsupported file"
}

/* ===== BROWSER ===== */
function openBrowser(){
  const c=createWindow("Browser")
  c.innerHTML=`
    <div style="display:flex;background:#222">
      <input id="addr" placeholder="https://example.com" style="flex:1">
      <button onclick="nav()">Go</button>
    </div>
    <iframe id="view" style="width:100%;height:100%;border:none"
      srcdoc="<h1 style='color:white;text-align:center'>üåå Galaxy Browser</h1>
      <p style='text-align:center'>Enter a URL above</p>">
    </iframe>`
  window.nav=()=>{
    let u=addr.value
    if(!u.startsWith("http"))u="https://"+u
    view.src=u
  }
}
</script>
</body>
</html>
