<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GALAXIA Launcher</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#050814">

<!-- PWA -->
<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;GALAXIA Launcher&quot;,
  &quot;short_name&quot;:&quot;GALAXIA&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#050814&quot;,
  &quot;theme_color&quot;:&quot;#050814&quot;
}">

<style>
body{margin:0;background:#050814;color:#fff;font-family:Segoe UI;overflow:hidden}
header{display:flex;gap:10px;padding:10px;background:#0b1026;align-items:center}
header h1{font-size:18px;margin:0}
input{flex:1;padding:8px;border-radius:6px;border:none}
button{background:#1a3cff;border:none;color:white;padding:8px 12px;border-radius:6px;cursor:pointer}
nav{display:flex;gap:8px;padding:8px;background:#090f2a}
nav button{background:#111}
#drop{margin:10px;padding:30px;border:2px dashed #4af;border-radius:12px;text-align:center;color:#8cf}
#library{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;padding:14px}
.card{background:#0c1230;border-radius:12px;padding:10px;cursor:pointer;transition:.2s}
.card:hover{transform:scale(1.05);box-shadow:0 0 20px #4af}
.thumb{height:90px;border-radius:8px;background:#111;display:flex;align-items:center;justify-content:center;font-size:12px;color:#6cf}
#player{position:fixed;inset:0;background:black;display:none;z-index:5}
#player iframe{width:100%;height:100%;border:none}
#exit{position:absolute;top:10px;right:10px;z-index:6;padding:10px;background:red;border:none;color:white}
small{color:#aaa}
</style>
</head>
<body>

<header>
  <h1>GALAXIA</h1>
  <input id="search" placeholder="Search games">
  <button id="installBtn" hidden>Install</button>
</header>

<nav>
  <button onclick="filter='all';render()">All</button>
  <button onclick="filter='installed';render()">Installed</button>
  <button onclick="filter='unity';render()">Unity WebGL</button>
  <button onclick="filter='web';render()">Web / GitHub</button>
  <button onclick="filter='fps';render()">FPS</button>
</nav>

<div id="drop">
  ðŸ“‚ Drag & Drop a Web Game Folder (HTML / Unity WebGL)
</div>

<div id="library"></div>

<div id="player">
  <button id="exit">Exit</button>
  <iframe allowfullscreen></iframe>
</div>

<script>
/* ================= DATA ================= */
let filter="all";
let installed=JSON.parse(localStorage.getItem("galaxia_installed")||"[]");

/* ===== GameScanner v4.0 (Curated, SAFE) ===== */
const scanner=[
 {name:"Shell Shockers",url:"https://shellshock.io",type:"web",fps:true},
 {name:"Deadshot.io",url:"https://deadshot.io",type:"web",fps:true},
 {name:"Ev.io",url:"https://ev.io",type:"web",fps:true},
 {name:"Krunker",url:"https://krunker.io",type:"web",fps:true},
 {name:"HexGL",url:"https://hexgl.bkcore.com",type:"web"},
 {name:"Babylon FPS Demo",url:"https://playground.babylonjs.com/#2FAJ2",type:"web",fps:true},
 {name:"Unity FPS Sample",url:"https://webglsamples.org/fps/",type:"unity",fps:true},
 {name:"PlayCanvas Shooter",url:"https://playcanv.as/p/2OlkUaxF/",type:"unity",fps:true},
];

/* pad to 30+ */
while(scanner.length<30){
  let g=scanner[scanner.length%8];
  scanner.push({...g,name:g.name+"+"});
}

const lib=document.getElementById("library");
const frame=document.querySelector("iframe");
const player=document.getElementById("player");

function save(){localStorage.setItem("galaxia_installed",JSON.stringify(installed));}

function render(){
  lib.innerHTML="";
  const q=search.value.toLowerCase();
  let list=[...scanner,...installed];

  list=list.filter(g=>{
    if(filter==="installed" && !installed.includes(g))return false;
    if(filter==="unity" && g.type!=="unity")return false;
    if(filter==="web" && g.type!=="web")return false;
    if(filter==="fps" && !g.fps)return false;
    return g.name.toLowerCase().includes(q);
  });

  list.forEach(g=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <div class="thumb">${g.type.toUpperCase()}</div>
      <b>${g.name}</b><br>
      <small>${g.played?Math.floor(g.played/60)+" min":"Click to Play"}</small>
    `;
    c.onclick=()=>launch(g);
    lib.appendChild(c);
  });
}
render();

/* ================= PLAY ================= */
function launch(g){
  g.last=Date.now();
  frame.src=g.url;
  player.style.display="block";
  setTimeout(()=>frame.requestFullscreen?.(),300);
}

/* ================= EXIT ================= */
exit.onclick=()=>{
  frame.src="";
  player.style.display="none";
};

/* ================= INSTALLER ================= */
drop.ondragover=e=>e.preventDefault();
drop.ondrop=e=>{
  e.preventDefault();
  const files=[...e.dataTransfer.files];
  let html=files.find(f=>f.name==="index.html");
  let unity=files.find(f=>f.name.endsWith(".loader.js"));
  if(!html&&!unity){alert("No playable game found");return;}
  const f=html||unity;
  installed.push({
    name:f.webkitRelativePath.split("/")[0],
    url:URL.createObjectURL(f),
    type:unity?"unity":"web",
    fps:true,
    played:0
  });
  save();render();
};

/* ================= PLAYTIME ================= */
setInterval(()=>{
  if(player.style.display==="block"){
    let g=[...scanner,...installed].find(x=>x.url===frame.src);
    if(g){g.played=(g.played||0)+1;}
  }
},1000);

/* ================= PWA INSTALL ================= */
let deferredPrompt;
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.hidden=false;
});
installBtn.onclick=()=>{
  deferredPrompt.prompt();
};
</script>
</body>
</html>
